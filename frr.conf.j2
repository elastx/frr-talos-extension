router bgp {{ ASN_METALLB_LOCAL }} vrf {{ NAMESPACE_METALLB }}
 bgp router-id {{ NODE_IP }}
 no bgp ebgp-requires-policy
 neighbor METALLB peer-group
 neighbor METALLB remote-as {{ ASN_METALLB_REMOTE }}
 neighbor METALLB passive
 neighbor {{ PEER_IP_REMOTE }} peer-group METALLB
 !
 address-family ipv4 unicast
  neighbor METALLB route-map denymap out
 exit-address-family
!

router bgp {{ ASN_LOCAL }}
 bgp router-id {{ NODE_IP }}
 no bgp ebgp-requires-policy
 bgp bestpath as-path multipath-relax
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as 48579
 neighbor FABRIC timers 1 3
 {% if not "no" in NEIGHBOR_PASSWORD %}
 neighbor FABRIC password {{ NEIGHBOR_PASSWORD }}
 {% endif %}

 neighbor 100.66.3.1 peer-group FABRIC
 neighbor 100.66.4.1 peer-group FABRIC
 !
 address-family ipv4 unicast
  redistribute connected route-map loopbacks
  import vrf {{ NAMESPACE_METALLB }}
 exit-address-family
!
ip prefix-list denyall seq 10 deny 0.0.0.0/0
!
route-map denymap permit 1
 match ip address prefix-list denyall
!
route-map SETSRC permit 10
 set src {{ NODE_IP }}
!
route-map loopbacks permit 10
  match interface lo
!
route-map loopbacks permit 20
  match interface dummy0
!
route-map loopbacks permit 30
  match interface dummy1
!
ip protocol bgp route-map SETSRC
!
line vty
!
log syslog debugging
